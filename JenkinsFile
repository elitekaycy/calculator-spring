pipeline {
    agent any

    stages {
       stage('Checkout') {
          // checkout the code from Git
          steps {
            checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/elitekaycy/calculator-spring.git']])
            bat 'mvn clean install'
          }
       }

       stage('Build Docker Image') {
           steps {
             script {
                   // Define Dockerfile location
                   def dockerfile = './DockerFile'

                   // Build Docker image
                   docker.build('calculator/calculator-app:latest', '-f ${dockerfile} .')
              }
           }
       }

       stage('Login and Push image to docker hub') {
            steps {
              script {
              withCredentials([string(credentialsId: 'jenkins-dockerhub', variable: 'jenkins-dockerhub')]) {
                         bat 'docker login -u elitekaycy -p ${jenkins-dockerhub}'

                         bat 'docker push calculator/calculator-app'
              }
             }
              }
            }
       }
    }