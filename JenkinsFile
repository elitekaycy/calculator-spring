pipeline {
    agent any

    stages {
       stage('Checkout') {
          // checkout the code from Git
          steps {
            checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/elitekaycy/calculator-spring.git']])
            bat 'mvn clean install'
          }
       }

       stage('Build Docker Image') {
           steps {
              // build docker image
              bat 'docker build -t calculator/calculator-app:latest .'
           }
       }

       stage('Login and Push image to docker hub') {
           environment {
               DOCKERHUB_CREDENTIAL = credentials('jenkins-dockerhub')
           }
          steps {
                 withCredentials([string(credentialsId: 'jenkins-dockerhub', variable: 'DOCKERHUB_CREDENTIAL')]) {
                     // Log in to Docker Hub
                     bat 'echo hello world'
                     bat "echo ${DOCKERHUB_CREDENTIAL} | docker login -u elitekaycy --password-stdin"

                     // Push the Docker image to Docker Hub
                     bat "docker push calculator/calculator-app"
                         }
                     }
              }
            }
       }