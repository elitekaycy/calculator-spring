pipeline {
    agent any

    stages {
       stage('Checkout') {
          // checkout the code from Git
          steps {
            checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/elitekaycy/calculator-spring.git']])
            sh 'mvn clean install'
          }
       }

       stage('Build Docker Image') {
           steps {
              // build docker image
              sh 'docker build -t calculator/calculator-app:latest .'
           }
       }

       stage('Login and Push image to docker hub') {
            steps {
              script {
              withCredentials([string(credentialsId: 'jenkins-dockerhub', variable: 'jenkins-dockerhub')]) {
                         sh 'docker login -u elitekaycy -p ${jenkins-dockerhub}'

                         sh 'docker push calculator/calculator-app'
              }
             }
              }
            }
       }
    }